<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Lomse library API documentation: mvc-model</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-50x67.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Lomse library API documentation
   &#160;<span id="projectnumber">0.17.20</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Overview</span></a></li>
      <li><a href="modules.html"><span>Types&#160;and&#160;constants</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_mainpages_mvc-model.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">mvc-model </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>.. sidebar:: This page was last modified on </p>
<pre class="fragment">Abr 3, 2012.
</pre><p>.. _mvc-model-root: </p>
<hr/>
 <h1>The Lomse MVC model </h1>
<p>To provide for high levels of modification, maintenance and reuse it is necessary to organise the application components around high level abstractions that provide isolation between the various functions of the GUI. The Model-View-Controller (MVC) architectural pattern is a well known paradigm for this. It provides a clean separation between three responsibilities: maintaining data (the Model), displaying all or a portion of the data (the View), and handling events that affect the model or view(s) (the Controller).</p>
<p>The MVC model has evolved over time. The Model and the View are components with simple and clear responsibilities, but the Controller has to deal with too many responsibilities. Therefore, there are many MVC variations that basically differ on how the Controller is modelled.</p>
<p>The Lomse library uses a MVC model based on ideas taken mainly form the TaskMaster architecture [1]_ and in minor degree from the Taligent Model-View-Presenter (MVP) pattern [2]_ and other references [3]_, [4]_.</p>
<p>The main objects in the Lomse MVC model are four: the <code>Document</code> (it is the Model), the <code>View</code>, the <code>Interactor</code> (a kind of Controller) and the <code>Presenter</code> (the 'glue' to join all the pieces).</p>
<p>The following figure shows the main involved objects and its relationships:</p>
<p>.. figure:: mvc-model.png :scale: 50 % :alt: The Lomse MVC model</p>
<p>The Lomse MVC model</p>
<p>Principles and design decisions </p>
<div class="fragment"><div class="line">Main concerns:</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#. The components around the MVC model (View, Document, Interactor, Presenter, Task, GraphicModel, Command, etc.) must have its responsibilities isolated. The knowledge one object has about the others should be minimized to enforce the single responsibility principle. </span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#. Simple API for Lomse user application. It is easy to inadvertely add code that requires knowledge about the other objects internals or to create an architecture that forces the user application to understand and deal with too many objects. Therefore, attention has been payd to not only separating responsibilities but also isolating the participants and channelling all communication through a simple communication protocol. </span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line">Application needs and concerns:</div>
<div class="line"></div>
<div class="line">* LDP document data (the Model: ``Document`` <span class="keyword">class</span>)</div>
<div class="line">* Data specification (``Selection`` <span class="keyword">class</span>)</div>
<div class="line">* Data manipulation (``Command`` <span class="keyword">class</span>)</div>
<div class="line">* Application/library interface (``Presenter`` <span class="keyword">class</span>)</div>
<div class="line">* User interaction (``Interactor`` <span class="keyword">class</span>, ``Task`` objects)</div>
<div class="line">* User presentation (``View`` <span class="keyword">class</span>). Different formats: graphical, sound, text-ldp, text-xml, other.</div>
<div class="line">* Other needs:</div>
<div class="line"></div>
<div class="line">  * Relating the <span class="keyword">internal</span> model and the graphical model</div>
<div class="line">  * Relating the <span class="keyword">internal</span> model and the sound model</div>
<div class="line">  * Play back: the same view needs to relate graphical &amp; sound models and synchronize them.</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">Involved objects</div>
</div><!-- fragment --><p>Document (the Model) It is responsible for storing the LDP document content and for notifying other objects when changes occur to the document.</p>
<p>It is owned by the Presenter.</p>
<p>Presenter The Presenter (short for 'document presenter') is a façade object responsible for coordinating all MVC involved classes within an application. It maintains the life cycle and relationships between Views, Interactors, Commands, Selections, and the Document. There is generally a single View per Presenter, though a Presenter may manage multiple logically related Views.</p>
<p>It is owned by user application</p>
<p>.. important:: As Presenter ownership is transferred to user application, you have to take care of deleting the Presenter when no loger needed. Deleting the Presenter will automaticall cause deletion of all MVC involved objets: the Document, all existing Views and Interactors, etc.</p>
<p>View The Document is presented to the user by a View. It normally has an associated window where the document is rendered. The Lomse library doesn’t provide any support for building windows or any other kind of GUI controls (all this must be part of the user application). The library just provides:</p>
<ul>
<li>the bitmaps with the renderized score, and</li>
<li>support for interacting with them.</li>
</ul>
<p>The View is responsible for providing bitmaps with the rendered score. It is user application responsibility to present this bitmap to the user (i.e. render it on a window, save it in a file, print it, or produce any other desired output).</p>
<p>The Document and its Views (there could be more than one), are related by the observer pattern.</p>
<p>The View is responsible:</p>
<ul>
<li>for providing output for the user application, usually bitmaps with the rendered music score.</li>
<li>for providing coordinates conversion between the bitmap and the world, and viceversa.</li>
</ul>
<p>It is owned by the Interactor.</p>
<p>Interactor It addresses how user events are mapped onto operations performed on the Document, such as mouse movements, keyboard input, and the selection of checkboxes or menu items. The interactor plays the role of the Controller in the MVC model and is responsible for intercepting all the events from the user interface and interpreting them into Commands and Selections that manipulate the Document.</p>
<p>It is responsible for re-directing requests to the appropriate objects.</p>
<p>It is a facade object for receiving user events and user application requests and returning any requested data.</p>
<pre class="fragment">It is owned by the Presenter.
</pre><p>Task To decide on the appropriate action, the Interactor delegates on a Task that is chosen by using the State pattern: The Task is an abstract object and the real object receiving the user event depends on the Interactor’s state. Each derivative of Task encapsulates an interaction with the user and eventually communicates with the document. The appropriate derivative of Task is selected by a menu command or click on a palette item, etc.</p>
<p>All Task derivatives are finite state machines. The events that drive the finite state machine are the mouse and keyboard events that are delegated by the Interactor to the Task.</p>
<p>Decides on the appropriate action for an event or sequence of events</p>
<p>It is owned by the Interactor.</p>
<p>Task object is described in detail in :ref:<code>task-root</code>.</p>
<p>GraphicModel Encapsulates the objects that compose the graphical model, providing services for:</p>
<ul>
<li>traversing the structure</li>
<li>hit testing</li>
<li>rendering (drawing)</li>
<li>Relating the graphical model to the internal model</li>
</ul>
<p>SoundModel Encapsulates the objects that compose the sound model, providing services for:</p>
<ul>
<li>play back</li>
<li>Relating the sound model to the internal model</li>
<li>Play back syncronization (relating graphical &amp; sound models)</li>
</ul>
<p>SelectionSet Specifies what portion of the data within the Document and/or the GraphicModel is to be operated upon. Examples would be selections which define bars, groups of notes and rests, instruments, columns, or individual elements which meet specific criteria.</p>
<p>(To be continued ...)</p>
<p>.. Command It defines the operations which can be performed on the Document. Examples might be deleting and inserting data, or printing the Document.</p>
<p>PresentersCollection Responsible for managing the collection of Presenter objects.</p>
<p>PresenterBuilder Responsible for creating Presenter objects.</p>
<p>Because the MVC triad is so important, a specialized object &ndash; the PresenterBuilder &ndash; takes care of hidding all of the complexity of creating and managing the necessary objects.</p>
<p><code>open_document()</code> and <code>close_document()</code> methods initiates and destroys, respectively, all related classes around a document:</p>
<ul>
<li>The Document itself</li>
<li>CommandExecuter and UserCommandExecuter, if needed</li>
<li>Views observing this Document</li>
<li>Interactors associated to the Views</li>
</ul>
<p>The PresenterBuilder uses:</p>
<ul>
<li>PresentersCollection, responsible for managing the collection of Presenter objects.</li>
<li>FileHistory, responsible of maintaining the list of recent opened files</li>
</ul>
<p>User interaction </p>
<div class="fragment"><div class="line">In the Lomse implementation of the MVC architecture, when user is allowed to interact with the document, the control flow is as follows:</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#. The user interacts with the user interface in some way (for example, presses a mouse button). All the events coming from the user interface are received by the user application window on which the View is rendered. Then, user app. re-directs these events to the associated Interactor object.</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#. The Interactor delegates the handling of the event on the current Task object. The Task object handles the event and converts it into appropriate actions either on the Document (Commands), on the GraphicModel (Selections), or both.</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#. If actions result in a change in the Document&#39;s state:</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">   #. The Document notifies its observing Views that it has been modified (Observer pattern). A change in the Document would imply, normally the need to update the View.</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">   #. In response to this notification, each View queries the Document in order to generate the appropriate changes in the user interface. The View gets its own data from the Document (push model. See :ref:`push-pull-models`.)</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#.  But if the actions result only in GraphicModel changes, the View is directly asked by the Task to update screen.</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#. If screen needs to be updated, Lomse generates an event for user application.</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#. The user interface waits for further user interactions, which restarts the cycle.</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line">.. _push-pull-models:</div>
<div class="line"></div>
<div class="line">Push Model vs. Pull Model</div>
</div><!-- fragment --><p>The Observer relationship between the View and the Document could follow a push or a pull model.</p>
<p>In the push model, the data that the observing view is interested in is "pushed" along with the message that notifies the observing view that the document has changed. For example, if a note is inserted in the score the note instance can be "pushed" in the "hint" argument of the on_update() method.</p>
<p>The alternative to the "push" model is to use the "pull" model. In the "pull" model, no data is sent in the on_update message. Upon receipt of the on_update message, the views must pull all the data from the document and redisplay it all.</p>
<p>For now, Lomse follows a pull model.</p>
<p>References ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>
<p>.. [1] "TASKMASTER: An Architecture Pattern for GUI Applications", Robert C. Martin, James W. Newkirk &amp; Bhama Rao. Available at <a href="http://www.objectmentor.com/resources/articles/taskmast.pdf">http://www.objectmentor.com/resources/articles/taskmast.pdf</a></p>
<p>.. [2] Mike Potel, "MVP: Model-View-Presenter. The Taligent Programming Model for C++ and Java". Available at <a href="http://www.wildcrest.com/Potel/Portfolio/mvp.pdf">http://www.wildcrest.com/Potel/Portfolio/mvp.pdf</a></p>
<p>.. [3] Derek Greer, "Interactive Application Architecture Patterns", August 2007. available at <a href="http://aspiringcraftsman.com/2007/08/25/interactive-application-architecture/">http://aspiringcraftsman.com/2007/08/25/interactive-application-architecture/</a></p>
<p>.. [4] Martin Fowler, "GUI Architectures", July 2006. Available at <a href="http://martinfowler.com/eaaDev/uiArchs.html">http://martinfowler.com/eaaDev/uiArchs.html</a> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Mar 12 2016 14:02:21 for Lomse library API documentation by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
