<html>
<!-- $Updated: 2016/02/13 -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Lomse changelog</title>
<link rel="stylesheet" media="all" href="singledoc.css" type="text/css" />
</head>
<body>

<h1>Lomse Library. Log of changes</h1>


<!-- ============================================================================ -->
<h3>Since last version</h3>

    <p>
    Mainly, changes for improving the MusicXML importer, for supporting
    more music notation elements and for implementing visual regression tests.
    </p>

	<h5>BACKWARDS INCOMPATIBLE CHANGES WITH 0.16.1</h5>

	<ul><li>none</li></ul>

	<h5>COMPATIBLE CHANGES</h5>

	<ul>
		<li>Version numbering scheme modified to add last commit sha1. Patch level
            automatically increased with every commit.</li>
		<li>Added method Interactor::get_num_pages() for improving the print API</li>
		<li>The XML parser (rapidxml) has been replaced by pugixml for better
            Unicode support.</li>
		<li>Line number added to error messages related to XML files, for better
            error reporting.</li>

		<li>Score layouting improved:
        <ul>
		    <li>Fixed bug 80222: Some measures are splitted in two systems</li>
		    <li>Fixed bug 80223: lack of space after intermediate barlines</li>
		    <li>ColumnsBreaker algorithm reviewed and fixed. More tests added.</li>
        </ul></li>

		<li>Added support for more music notation elements:
        <ul>
		    <li>articulations</li>
		    <li>ornaments</li>
		    <li>technical notations (just a few)</li>
		    <li>dynamics notations</li>
		    <li>slurs</li>
		    <li>lyrics</li>
        </ul></li>

		<li>Continue development of MusicXML importer:
        <ul>
    		<li>barlines, repetition barlines and barlines at start of measures</li>
    		<li>augmentation dots for notes and rests</li>
    		<li>beams</li>
    		<li>backup/forward</li>
    		<li>full-measure rests</li>
    		<li>fermatas</li>
    		<li>ties</li>
		    <li>articulations</li>
		    <li>ornaments</li>
		    <li>technical notations (just a few)</li>
		    <li>dynamics notations</li>
		    <li>slurs</li>
		    <li>lyrics</li>
		    <li>derive note type from duration when type not present</li>
        </ul></li>

		<li>Modifications in internal model:
        <ul>
    		<li>duration now explicit value for note/rest in internal model</li>
    		<li>explicit mark in rests for full measure rests</li>
    		<li>orientation flag added to ties, for avoiding having to use a bezier 
                element for changing default orientation.</li>
		    <li>added several classes for supporting the added elements.</li>
        </ul></li>

		<li>Renderization:
        <ul>
		    <li>Added engravers and all need objects (glyphs, shapes, etc) for
	            the new added music notation elements.</li>
        </ul></li>

		<li>Small fixes:
        <ul>
    		<li>Removed background borders in document images generated for printing.</li>
        </ul></li>

		<li>Other chages:
        <ul>
		    <li>CMakeLists.txt build script modified so that library name will be
	            always 'liblomse', without version numbers.</li>
		    <li>CmakeLists.txt  build script modified so that by default, the unit
                tests runner program (testlib) is always built.</li>
		    <li>All tests files reviewed and reorganized for visual regression
                tests. Scripts for this created, so that regression tests will now
                systematically be run after every library build.</li>
		    <li>Added tutorial 1 for using Lomse in Qt applications.</li>
		    <li>Fixed all warnings due to 'unused parameter'</li>
        </ul></li>
    </ul>


<!-- ============================================================================ -->
<h3>Version 0.16.1 (7/Sep/2015)</h3>

    <p>
    Mainly, changes for using SMuFL compliant music fonts and for implementing support
    for new features required by eBook L3_MusicReading in Phonascus. Some bug fixes.
    </p>

	<h5>BACKWARDS INCOMPATIBLE CHANGES WITH 0.15.0</h5>

	<ul>
		<li>Constants ImoStyle::k_bold and k_italics renamed as k_font_style_italic and
            k_font_weight_bold. Constant k_font_normal splitted into k_font_style_normal
            and k_font_weight_normal. Required changes: replace the renamed constants:
            <ul>
	            <li>ImoStyle::k_bold    &rarr; replace by  ImoStyle::k_font_weight_bold</li>
	            <li>ImoStyle::k_italic  &rarr; replace by  ImoStyle::k_font_style_italic</li>
	            <li>ImoStyle::k_normal  &rarr; replace by  ImoStyle::k_font_weight_normal or</li>
                <li>ImoStyle::k_font_style_normal, depending on case.</li>
            </ul></li>
	</ul>

	<h5>COMPATIBLE CHANGES</h5>

	<ul>
		<li>ImFactory modified to ensure that Id is assigned *before* the imo is created.
            This fixes a design problem causing bug 80211.</li>
		<li>Code modified for using SMuFL compliant music fonts. Default font changed to
            Bravura font. LenMus font (lmbasic2.ttf) removed, and from now unsupported.</li>
		<li>Defined default style for metronome marks. Added code for controlling that
            default styles are not exported to source code unless they are modified.</li>
		<li>Added support for common time and cut time signatures (LDP language, LdpAnalyser,
            LdpExporter, TimeSignatureEngraver, ImoTimeSignature and other related changes).</li>
		<li>Fixed bugs 80213 and 80214 in examples for tutorials</li>
		<li>Score chopin_prelude_v20.lms updated for fixing bug 80212</li>
		<li>Included all note symbols and dots in metronome marks</li>
		<li>Trace levels added to spacing algorithms</li>
		<li>Fixed bug 80215: First goFwd doesn't work properly and notes get overlapped.</li>
		<li>Fixed bug 80217: Stem length in chords incorrectly computed: too long.</li>
		<li>Fixed bug 80216: Fermata in note on second staff is positioned on first staff.</li>
	</ul>


<!-- ============================================================================ -->
<h3>Version 0.15.0 (27/Mar/2015)</h3>
	<p>
	Development continues. Mainly changes for supporting document edition. A few backwards
	incompatible changes, that will require a couple of fixes in existing code using this
	library. 
	</p>

	<h5>BACKWARDS INCOMPATIBLE CHANGES WITH 0.14.0</h5>

	<ul>
		<li>enum EBarlines created.
		  &rarr; Backwards compatibility: You have to replace all barline constants, 
		      such as "ImoBarline::k_simple" by "k_barline_simple", etc</li>
		<li>The update screen policy has been reviewed and clarified. As a consequence some
		  changes has been made affecting, mainly, to Interactor class. 
		  &rarr; Backwards compatibility: Interactor::new_viewport() and all Interactor
		      methods for changing scale and zooming factor, now force a redraw. A third
		      parameter (bool fForceRedraw=true) has been added to these methods. You can 
		      modify your existing code by specifying fForceRedraw=false for preventing
		      redraws and keep the old behaviour</li>
		<li>File format parameter added to LomseDorway::new_document() and 
		  PresenterBuilder::new_document() for choosing source code format.
		  &rarr; Backwards compatibility: You will have to review your code and add 
		      this parameter with value 'Document::k_format_ldp' as that was the
		      expected format in previous versions.</li>
	</ul>

	<h5>COMPATIBLE CHANGES</h5>

	<ul>
		<li>Version changed to 0.15.0</li>
		<li>Shape id now generated and assigned to shapes. Methods in GModel to find
		  a shape reviewed</li>
		<li>ScoreCursor now skips implicit key and time signatures</li>
		<li>TimeInfo class implemented, for computing timecode and related data</li>
		<li>ScoreCursor now provides TimeInfo data</li>
		<li>DocCommandExecuter now saves cursor state and uses it in undo/redo</li>
		<li>DocCommand::perform_action() now return int indicating success/failure</li>
		<li>DocCommand added to undo/redo stack only if execution success</li>
		<li>Problems detected with delete staffobj command => Solution: goBack/goFwd
		  reconsidered. goBack removed. goFwd as special non-visible rest. Voice
		  now mandatory. LDP version changed to 2.0</li>
		<li>ColStaffObjs changed to deal with LDP 2.0</li>
		<li>Added 'add staff obj.' command</li>
		<li>Added 'add tie' command</li>
		<li>Added 'add tuplet' command</li>
		<li>Added 'change dots' command</li>
		<li>Added 'delete block level obj.' command</li>
		<li>Added 'delete relation' command</li>
		<li>Added 'delete staff obj.' command</li>
		<li>Added 'break beam' command</li>
		<li>Added 'join beam' command</li>
		<li>Added 'insert block level obj.' command</li>
		<li>Added 'insert staff obj.' command</li>
		<li>Added 'insert many staff objs.' command</li>
		<li>Lomse now provides events when the set of selected objects change and when
		  a commnad is executed</li>
		<li>SelectionSet now contains and provides an ordered ColStaffObjs object 
		  containing all selected staffobjs</li>
		<li>SelectionSet now provides validations on selections, for enabling/disabling
		  tools. You can override these default validations to have a different 
		  behaviour in your applications</li>
		<li>Commands now receive optional name, to support i18n</li>
		<li>Added im_attributes</li>
		<li>Reviewed engravers for taking into account object color</li>
		<li>Commands redesigned for accepting target from selection set</li>
		<li>TimeGridTable now created for each GmoBoxSystem</li>
		<li>Class TimeGrid created. Grid displayed on system in which caret is placed</li>
		<li>Created TaskDataEntry for supporting data entry using mouse</li>
		<li>Added OverlaysGenerator and VisualEffect classes, for improving performance,
		  optimizing repaints and providing a common architecture for all visual
		  effects</li>
		<li>Paint event (k_update_window_event) now includes damaged rectangle 
		  information so that user application can optimize repaints</li>
		<li>Selection rectangle, caret, playback highlight and time grid are now implemented 
		  as VisualEffect objects, for improving visual speed and for uniform treatment
		  of all dynamic visual effects</li>
		<li>Added DraggedImage class for supporting dragged images</li>
		<li>TaskSelection behavior changed to deal with more complex behaviour required by
		  interactive edition. More tasks added: TaskSelectionRectangle, TaskMoveObject</li>
		<li>Added Handler visual effect class. Support implemented in GmoShapeTie</li>
		<li>Class NoterestEngraver removed</li>
		<li>Some engravers modified for creating shapes to be dragged without requiring
		  to tie them to an ImoObj.</li>
		<li>Select objects with click, add to selection with Ctrl+click.</li>
		<li>Shapes related to notes and rests modified to take voice into account so 
		  that voices can now be coloured, hidden, etc</li>
		<li>RenderingOptions now includes options for highlighting current selected 
		  voice and for colouring voices</li>
		<li>Document modified for detecting if it has been changed since las time it was
		  saved. DocCommandExecuter now controls when document is modified and keeps
		  it synchronized with undo/redo.</li>
		<li>All ImoObj objects now have flags to control edit options on each object</li>
		<li>Composite commands implemented</li>
		<li>CmdAddNoteRest for replace edition mode implemented</li>
		<li>Caret behaviour redefined and all cursors re-implemented</li>
		<li>Commands refactored for using new methods for updating cursor</li>
		<li>ModelBuilder was only dealing with scores at first level. This is now 
		  fixed and can deal with scores at inner levels</li>
		<li>Edition flags added to all ImoObj, to allow for selective edition</li>
		<li>DocCursor improved to traverse documents with nested content</li>
		<li>DocCursor now supports 'jailed' mode: cursor cannot exit the specified object</li>
		<li>Added 'restricted' edition mode: Only specified object can be edited, and it cannot be deleted.</li>
		<li>Added method 'play_measures()' to allow playing a certain number of
		  measures starting at any meaure.</li>
		<li>Fixed dots position in repetition barlines</li>
		<li>Starting MusicXML support:
		  <ul>
		  <li>Added classes MxlCompiler, MxlAnalyser</li>
		  <li>Class LmdParser renamed as XmlParser. Files renamed.</li>
		  </ul></li>
		<li>Changes for MusicXML import: Minimal functionality for MxlAnalyser implementated and tested</li>
	</ul>


<!-- ============================================================================ -->
<h3>Version 0.14.0 (3/May/2013)</h3>
    <p>Fixes to support Chinese language, bug fixes related to multi-threading,
       other fixes and some refactoring.</p>

    <ul>
        <li>Version number increased to 0.14.0 due to backwards incompatible API changes.</li>
        <li>Document and Interactor raw pointers are now converted to shared pointers
          when ownership is transferred to Presenter.</li>
        <li>All Presenter API raw pointers to Document and to Interactor changed 
          to weak_ptr.</li>
        <li>All events receive now a weak_ptr to Interactor instead of a raw_ptr so
          that code processing event can check if the event is still valid.</li>
        <li>Limitation removed: Time units now represented as double.</li>
        <li>Fixed bug in Ctrol objects: bad font selected for Chinese language.</li>
        <li>Changed GmoShapeText and ImoScoreText to include language .</li>
        <li>PresentersCollection removed: not used and not needed.</li>
        <li>Fixed bug in ColStaffObjs iterator causing problems in destructor.</li>
        <li>ScorePlayerCtrol: changes to use a graphical UI.</li>
        <li>Refactoring: classes RefToGmo and MultiRefToGmo removed (not used).</li>
        <li>Refactoring: GmoShape Id type changed from int to ShapeId.</li>
        <li>Refactoring: ImoObj Id type changed from long to ImoId.</li>
        <li>Refactoring: GmoRef defined. Maps to get Gmo for Imo revised.</li>
        <li>Bug fixed in DefaultTextSplitter causing an infinite loop (app. hangs).</li>
        <li>Bug fixed in ScorePlayer causing occational crashes.</li>
        <li>Bug fixed in Interactor mouse events processing, causing crashes.</li>
        <li>Logger class developped. Logging messages added in many places.</li>
    </ul>



<!-- ============================================================================ -->
<h3>Version 0.13.1</h3>
    <p>Implementing edition (2). Caret and CaretPositioner.</p>

    <ul>
        <li>Version number increased to 0.13.1</li>
        <li>Caret object implemented: a displayable cursor on the document.</li>
        <li>CaretPositioner implemented: responsible for Caret layout and position.</li>
        <li>Interactor/Presented modified to create/own DocCursor & DocCommandExecuter</li>
        <li>GraphicView modified to display Caret</li>
        <li>Interactor: added methods to control Caret state and position</li>
        <li>ScoreCursor: state now includes timepos for ref_obj.</li>
        <li>ScoreCursor: added method to find previous staffobj</li>
        <li>ScoreCursor: added helper methods to test for position type.</li>
        <li>GModel modified for accesing a GmoBox given the id of its creator Imo</li>
        <li>GModel: added helper methods for positioning caret.</li>
    </ul>


<!-- ============================================================================ -->
<h3>Version 0.13.0</h3>
    <p>Implementing edition commands (1). Refactoring and required functionality.</p>

    <ul>
        <li>More funcionality:
        <ul>
            <li>DocumentCursor and children cursors created.</li>
            <li>ScoreCursor: changes for moving on a time grid</li>
            <li>Added ScoreModifier class: Preliminary code to delete a staffobj</li>
        </ul></li>

        <li>Changes for ensuring integrity after an edit operation:
        <ul>
            <li>IdAssiner now responsible for translation from ImoObj Id to pointer to ImoObj.</li>
            <li>ImoObj pointer replaced by ImoObj id. in many API methods</li>
        </ul></li>

        <li>Changes for supporting undo/redo:
        <ul>
            <li>LDP: comments now also posible in C style (/*..*/)</li>
            <li>Document: generates checkpoints and restore from checkpoint.</li>
            <li>LmdExporter: main tags operational with scores in ldp format.</li>
        </ul></li>

        <li>Refactoring:
        <ul>
            <li>version number increased to 0.13, to reflect backward incompatible API changes</li>
            <li>Added ButtonCtrl. All Controls reviewed to ensure uniform approach.</li>
            <li>ColStaffObjs: adding support inserting/deleting objects
            <ul>
                <li>time now kept in staffobj instead of in ColStaffObjEntry</li>
                <li>change ColStaffObjs to a double linked list. Sort during insertion</li>
                <li>change ColStaffObjsBuilder to remove goBack/goFwd nodes</li>
            </ul></li>
        </ul></li>
    </ul>


<!-- ============================================================================ -->
<h3>Version 0.12.5 (24/Nov/2012)</h3>
<ul>
    <li>Added public method GmoShapeImage::set_image().</li>
    <li>Added progress bar control (class ProgressBarCtrl).</li>
    <li>Bug fixed: background color doesn't change if a different color specified.</li>
</ul>

<!-- ============================================================================ -->
<h3>Version 0.12 (7/Sep/2012)</h3>
<ul>
    <li>TextSplitter class added, to support different languages.</li>
    <li>Language and font-file tags added to LDP and LMD analysers.</li>
    <li>Added default font for Chinese.</li>
    <li>Added Metronome class.</li>
    <li>Added CheckboxCtrl class.</li>
    <li>Changes in PlayerGui class. Defined PlayerNoGui class.</li>
    <li>Changes for allowing customization of ScorePlayerCtrl at Lomse initialization.</li>
    <li>Changes in ScorePlayer for better usage of PlayerGui.</li>
    <li>Fixed bug in ScorePlayerCtrol, preventing labels translation.</li>
    <li>ScorePlayer::quit() method added, to avoid problems during user application quit.</li>
</ul>


<h3>Version 0.11</h3>
<ul>
    <li>Added method LomseDoorway::set_default_fonts_path() so that applications linking Lomse statically can inform Lomse about the path where default fonts are located.</li>
</ul>


<h3>Version 0.10.b1</h3>
    <li>Initial public release, used in Phonascus 5.0 beta for Linux.</li>
</ul>
